%YAML:1.0

#--------------------------------------------------------------------------------------------
# Camera Parameters. Adjust them!
#--------------------------------------------------------------------------------------------

# Camera calibration and distortion parameters (OpenCV) 
Camera.fx: 334.125854
Camera.fy: 334.125854
Camera.cx: 348.498749
Camera.cy: 187.100311

Camera.k1: 0.0
Camera.k2: 0.0
Camera.p1: 0.0
Camera.p2: 0.0

Camera.width: 672
Camera.height: 376

# Camera frames per second 
Camera.fps: 20.0

# stereo baseline times fx
Camera.bf: 40.0951

# Color order of the images (0: BGR, 1: RGB. It is ignored if images are grayscale)
Camera.RGB: 0

# Close/Far threshold. Baseline times.
ThDepth: 35

#--------------------------------------------------------------------------------------------
# Stereo Rectification. Only if you need to pre-rectify the images.
# Camera.fx, .fy, etc must be the same as in LEFT.P
#--------------------------------------------------------------------------------------------
LEFT.height: 376
LEFT.width: 672
LEFT.D: !!opencv-matrix
   rows: 1
   cols: 5
   dt: d
   data:[-0.28340811, 0.07395907, 0.00019359, 1.76187114e-05, 0.0]
LEFT.K: !!opencv-matrix
   rows: 3
   cols: 3
   dt: d
   data: [458.654, 0.0, 367.215, 0.0, 457.296, 248.375, 0.0, 0.0, 1.0]
LEFT.R:  !!opencv-matrix
   rows: 3
   cols: 3
   dt: d
   data: [0.999966347530033, -0.001422739138722922, 0.008079580483432283, 0.001365741834644127, 0.9999741760894847, 0.007055629199258132, -0.008089410156878961, -0.007044357138835809, 0.9999424675829176]
LEFT.P:  !!opencv-matrix
   rows: 3
   cols: 4
   dt: d
   data: [435.2046959714599, 0, 367.4517211914062, 0,  0, 435.2046959714599, 252.2008514404297, 0,  0, 0, 1, 0]

RIGHT.height: 376
RIGHT.width: 672
RIGHT.D: !!opencv-matrix
   rows: 1
   cols: 5
   dt: d
   data:[-0.28368365, 0.07451284, -0.00010473, -3.555907e-05, 0.0]
RIGHT.K: !!opencv-matrix
   rows: 3
   cols: 3
   dt: d
   data: [457.587, 0.0, 379.999, 0.0, 456.134, 255.238, 0.0, 0.0, 1]
RIGHT.R:  !!opencv-matrix
   rows: 3
   cols: 3
   dt: d
   data: [0.9999633526194376, -0.003625811871560086, 0.007755443660172947, 0.003680398547259526, 0.9999684752771629, -0.007035845251224894, -0.007729688520722713, 0.007064130529506649, 0.999945173484644]
RIGHT.P:  !!opencv-matrix
   rows: 3
   cols: 4
   dt: d
   data: [435.2046959714599, 0, 367.4517211914062, -47.90639384423901, 0, 435.2046959714599, 252.2008514404297, 0, 0, 0, 1, 0]

#--------------------------------------------------------------------------------------------
# ORB Parameters
#--------------------------------------------------------------------------------------------

# ORB Extractor: Number of features per image
ORBextractor.nFeatures: 1200

# ORB Extractor: Scale factor between levels in the scale pyramid 	
ORBextractor.scaleFactor: 1.2

# ORB Extractor: Number of levels in the scale pyramid	
ORBextractor.nLevels: 8

# ORB Extractor: Fast threshold
# Image is divided in a grid. At each cell FAST are extracted imposing a minimum response.
# Firstly we impose iniThFAST. If no corners are detected we impose a lower value minThFAST
# You can lower these values if your images have low contrast			
ORBextractor.iniThFAST: 20
ORBextractor.minThFAST: 7

#--------------------------------------------------------------------------------------------
# Viewer Parameters
#--------------------------------------------------------------------------------------------
Viewer.KeyFrameSize: 0.05
Viewer.KeyFrameLineWidth: 1
Viewer.GraphLineWidth: 0.9
Viewer.PointSize:2
Viewer.CameraSize: 0.08
Viewer.CameraLineWidth: 3
Viewer.ViewpointX: 0
Viewer.ViewpointY: -0.7
Viewer.ViewpointZ: -1.8
Viewer.ViewpointF: 500

# kf decision (SLAM) parameters
min_entropy_ratio     : 0.85
max_kf_t_dist         : 5.0
max_kf_r_dist         : 15.0

# StVO-PL options
# -----------------------------------------------------------------------------------------------------
has_points         : 1      # 1 if using points
has_lines          : 1      # 1 if using line segments
use_fld_lines      : 0     # 1 if using FLD detector
lr_in_parallel     : 1      # 1 if detecting and matching features in parallel
pl_in_parallel     : 1      # 1 if detecting points and line segments in parallel
best_lr_matches    : 1      # 1 if double-checking the matches between the two images
adaptative_fast    : 1      # 1 if using adaptative fast_threshold
use_motion_model   : 0     # 1 if using constant motion model
#TODO: adaptative fld threshold

# Tracking parameters
# -----------------------------------------------------------------------------------------------------
# Point features
max_dist_epip     : 0.0        # max. epipolar distance in pixels
min_disp          : 1.0        # min. disparity (avoid points in the infinite)
min_ratio_12_p    : 0.75       # min. ratio between the first and second best matches

# Line segment features
line_sim_th       : 0.75       # threshold for cosine similarity
stereo_overlap_th : 0.75
f2f_overlap_th    : 0.75
min_line_length   : 0.025       # min. line length (relative to img size)
line_horiz_th     : 0.1        # parameter to avoid horizontal lines (pixels)
min_ratio_12_l    : 0.75       # parameter to avoid outliers in line matching
ls_min_disp_ratio : 0.7        # min ratio between min(disp)/max(disp) for a LS

# Adaptative FAST parameters
fast_min_th       : 5          # min. value for FAST threshold
fast_max_th       : 30         # max. value for FAST threshold
fast_inc_th       : 5          # base increment for the FAST threshold
fast_feat_th      : 50         # base number of features to increase/decrease FAST threshold
fast_err_th       : 0.5        # threshold for the optimization error

# TODO: add similar adaptative FAST for FLD (take care with the min and max values regarding performance)

# RGB-D features
rgbd_min_depth    : 0.5
rgbd_max_depth    : 3.0

# Optimization parameters
# -----------------------------------------------------------------------------------------------------
homog_th         : 1e-7        # avoid points in the infinite
min_features     : 10          # min. number of features to perform StVO
max_iters        : 5           # max. number of iterations in the first stage of the optimization
max_iters_ref    : 10          # max. number of iterations in the refinement stage
min_error        : 1e-7        # min. error to stop the optimization
min_error_change : 1e-7        # min. error change to stop the optimization
inlier_k         : 4.0         # factor to discard outliers before the refinement stage

# Feature detection parameters
# -----------------------------------------------------------------------------------------------------
matching_stereo   : 0          # 0 - pure descriptor based  |  1 - window based plus descriptor
matching_s_ws     : 10         # size of the windows (in pixels) to look for stereo matches (if matching_stereo=1)
matching_f2f_ws   : 3          # size of the windows (in pixels) to look for f2f matches

# ORB detector
orb_nfeatures    : 1200        # number of ORB features to detect
orb_scale_factor : 1.2         # pyramid decimation ratio for the ORB detector
orb_nlevels      : 4           # number of pyramid levels
orb_edge_th      : 19          # size of the border where the features are not detected
orb_wta_k        : 2           #  number of points that produce each element of the oriented BRIEF descriptor 
orb_score        : 1           # 0 - HARRIS  |  1 - FAST
orb_patch_size   : 31          # size of the patch used by the oriented BRIEF descriptor.
orb_fast_th      : 20          # default FAST threshold
# LSD parameters
lsd_nfeatures    : 300         # number of LSD lines detected (set to 0 if keeping all lines)
lsd_refine       : 0           # the way of refining or not the detected lines
lsd_scale        : 1.2         # scale of the image that will be used to find the lines
lsd_sigma_scale  : 0.6         # sigma for Gaussian filter
lsd_quant        : 2.0         # bound to the quantization error on the gradient norm
lsd_ang_th       : 22.5        # gradient angle tolerance in degrees
lsd_log_eps      : 1.0         # detection threshold (only for advanced refinement)
lsd_density_th   : 0.6         # minimal density of aligned region points in the enclosing rectangle
lsd_n_bins       : 1024        # number of bins in pseudo-ordering of gradient modulus


# -----------------------------------------------------------------------------------------------------
# PLSLAM parameters
# -----------------------------------------------------------------------------------------------------

fast_matching         : 1
mutithread_slam       : 1
has_refinement        : 0

# lm numbers and errors
min_lm_obs            : 5
max_common_fts_kf     : 0.9

max_kf_epip_p         : 1.0
max_kf_epip_l         : 1.0

max_lm_3d_err         : 0.1
max_lm_dir_err        : 0.1
max_point_point_error : 0.1
max_point_line_error  : 0.1
max_dir_line_error    : 0.1

# graphs parameters
min_lm_ess_graph      : 150
min_lm_cov_graph      : 75
min_kf_local_map      : 3

# LBA
lambda_lba_lm         : 0.00001     # (if auto, this is the initial tau)
lambda_lba_k          : 10.0
max_iters_lba         : 15

# Loop closure
vocabulary_p          : ""
vocabulary_l          : ""

lc_mat                : 0.5
lc_res                : 1.5
lc_unc                : 0.01
lc_inl                : 0.3
lc_trs                : 1.5
lc_rot                : 35.0

max_iters_pgo         : 100
lc_kf_dist            : 50
lc_kf_max_dist        : 50
lc_nkf_closest        : 4
lc_inlier_ratio       : 30.0

min_pt_matches        : 10
min_ls_matches        : 6
